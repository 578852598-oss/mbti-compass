<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>MBTI å¿ƒç†çŠ¶æ€ç½—ç›˜</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif+SC:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <style>
    :root{
      --bg:#ffffff; --surface:#ffffff; --surface-2:#f8fafc; --line:#e2e8f0;
      --text:#0f172a; --muted:#64748b; --muted-light:#94a3b8;
      
      /* å“ç‰Œè‰² */
      --brand:#2563eb; 
      
      /* å››å¤§ç±»å‹è‰²ç³» (å‚è€ƒä¸»æµé…è‰²) */
      --color-nt: #8b5cf6; --bg-nt: #f5f3ff; /* ç´«è‰² - åˆ†æå®¶ */
      --color-nf: #10b981; --bg-nf: #ecfdf5; /* ç»¿è‰² - å¤–äº¤å®¶ */
      --color-sj: #3b82f6; --bg-sj: #eff6ff; /* è“è‰² - å®ˆæŠ¤è€… */
      --color-sp: #f59e0b; --bg-sp: #fffbeb; /* é»„è‰² - æ¢é™©å®¶ */

      --radius:20px; 
      --shadow:0 10px 40px -10px rgba(0,0,0,0.05);
      --shadow-hover:0 20px 40px -10px rgba(0,0,0,0.1);
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
    body{ margin:0; font-family: Inter, system-ui, -apple-system, sans-serif; color:var(--text); background: var(--surface-2); padding-bottom: 40px;}
    
    .container{ max-width: 720px; margin: 0 auto; padding: 20px 16px; }
    
    /* Topbar */
    .topbar{ position: sticky; top: 0; z-index: 50; background: rgba(255,255,255,0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); transition: transform 0.3s; }
    .topbar-inner{ max-width: 720px; margin: 0 auto; padding: 12px 16px; display:flex; align-items:center; justify-content:space-between; height: 60px; }
    
    .brand{ display:flex; align-items:center; gap:10px; cursor: pointer; }
    .logo{ width:32px; height:32px; border-radius: 10px; background: var(--brand); color: #fff; display:flex; align-items:center; justify-content:center; font-weight:800; font-size: 14px; }
    .brand-text{ font-weight: 700; font-size: 15px; letter-spacing: -0.5px; }

    .controls{ display:flex; align-items:center; gap:12px; }
    
    /* å½“å‰çŠ¶æ€èƒ¶å›Š */
    .status-capsule{ display:none; align-items:center; gap:8px; padding: 4px 4px 4px 12px; background: #fff; border:1px solid var(--line); border-radius: 99px; font-size: 13px; font-weight: 600; box-shadow: 0 2px 6px rgba(0,0,0,0.03); }
    .status-capsule span{ color: var(--brand); }
    .btn-change{ background: var(--surface-2); border:none; padding: 6px 12px; border-radius: 99px; color: var(--muted); font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .btn-change:hover{ background: #e2e8f0; color: var(--text); }

    /* =========================================
       æ–°å…¥å£ï¼šç±»å‹é€‰æ‹©å™¨ (Landing Page)
       ========================================= */
    #landing-page{ display: block; animation: fadeIn 0.5s ease; }
    .hero{ text-align: center; padding: 40px 0 30px; }
    .hero h1{ font-family: "Noto Serif SC", serif; font-size: 32px; margin: 0 0 12px; color: var(--text); letter-spacing: -1px; }
    .hero p{ font-size: 15px; color: var(--muted); line-height: 1.6; max-width: 480px; margin: 0 auto; }

    .group-title{ font-size: 12px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin: 24px 0 10px; color: var(--muted-light); display:flex; align-items:center; gap:8px; }
    .group-title::after{ content:''; flex:1; height:1px; background: var(--line); }
    
    .type-grid{ display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    
    /* ç§»åŠ¨ç«¯æ”¹ä¸º2åˆ— */
    @media(max-width: 640px){ .type-grid{ grid-template-columns: repeat(2, 1fr); } }

    .type-card{ 
      position: relative; border: none; border-radius: 16px; padding: 16px; 
      text-align: left; cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex; flex-direction: column; justify-content: space-between; height: 90px;
      overflow: hidden;
    }
    .type-card:hover{ transform: translateY(-3px); box-shadow: var(--shadow-hover); }
    .type-card:active{ transform: scale(0.98); }

    .type-card strong{ font-size: 20px; font-weight: 800; display: block; font-family: 'Inter', sans-serif; letter-spacing: -0.5px; }
    .type-card span{ font-size: 12px; font-weight: 600; opacity: 0.8; margin-top: 4px; display: block; }
    
    /* è£…é¥°æ€§èƒŒæ™¯å›¾æ ‡ */
    .type-card::after{ 
      content: attr(data-type); 
      position: absolute; right: -10px; bottom: -15px; 
      font-size: 60px; font-weight: 900; opacity: 0.06; 
      font-family: sans-serif; pointer-events: none;
    }

    /* æ–°å¢ï¼šç­¹å¤‡ä¸­æ ‡ç­¾æ ·å¼ */
    .badge-soon {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(255,255,255,0.7); /* åŠé€æ˜ç™½åº• */
      backdrop-filter: blur(4px);        /* æ¯›ç»ç’ƒæ•ˆæœ */
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 800;
      color: #64748b;                    /* ç°è‰²æ–‡å­— */
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      z-index: 2;
    }

    /* æ–°å¢ï¼šSäººå¡ç‰‡çš„ç‰¹æ®ŠçŠ¶æ€ï¼ˆç¨å¾®å˜æ·¡ï¼Œæ›´æœ‰â€œæœªè§£é”â€çš„æ„Ÿè§‰ï¼‰ */
    .card-locked {
      opacity: 0.75; 
      filter: grayscale(0.2); /* ç¨å¾®å»è‰² */
    }
    .card-locked:hover {
      transform: none;      /* ç¦ç”¨ä¸Šæµ®åŠ¨ç”» */
      box-shadow: none;     /* ç¦ç”¨é˜´å½± */
      opacity: 0.9;         /* hoveræ—¶ç¨å¾®äº®ä¸€ç‚¹ï¼Œæç¤ºå¯ç‚¹å‡» */
      cursor: not-allowed;  /* é¼ æ ‡å˜æˆç¦æ­¢æ‰‹åŠ¿ï¼ˆæˆ–è€…ä¿ç•™ pointer é…åˆå¼¹çª—ï¼‰ */
    }

    /* é¢œè‰²é…ç½® */
    .nt-card{ background: var(--bg-nt); color: var(--color-nt); border: 1px solid rgba(139, 92, 246, 0.1); }
    .nt-card:hover{ background: #ede9fe; border-color: var(--color-nt); }
    
    .nf-card{ background: var(--bg-nf); color: var(--color-nf); border: 1px solid rgba(16, 185, 129, 0.1); }
    .nf-card:hover{ background: #d1fae5; border-color: var(--color-nf); }
    
    .sj-card{ background: var(--bg-sj); color: var(--color-sj); border: 1px solid rgba(59, 130, 246, 0.1); }
    .sj-card:hover{ background: #dbeafe; border-color: var(--color-sj); }
    
    .sp-card{ background: var(--bg-sp); color: var(--color-sp); border: 1px solid rgba(245, 158, 11, 0.1); }
    .sp-card:hover{ background: #fef3c7; border-color: var(--color-sp); }


    /* =========================================
       ç­”é¢˜é¡µ & ç»“æœé¡µ (é»˜è®¤éšè—)
       ========================================= */
    #quiz-interface{ display: none; animation: slideUp 0.4s ease; }
    
    .q-progress-box{ margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
    .progress-track{ flex:1; height: 8px; background: #e2e8f0; border-radius: 99px; overflow: hidden; }
    .progress-fill{ height: 100%; background: var(--brand); width: 0%; transition: width 0.3s ease; border-radius: 99px; }
    .progress-text{ font-size: 12px; font-weight: 600; color: var(--muted); width: 40px; text-align: right; }

    .card{ background: #fff; border-radius: var(--radius); padding: 24px; margin-bottom: 20px; box-shadow: var(--shadow); border: 1px solid #fff; }
    .qtext{ font-size: 17px; font-weight: 600; line-height: 1.6; margin: 10px 0 24px; color: var(--text); }
    .qmeta{ font-size: 12px; font-weight: 700; color: var(--brand); text-transform: uppercase; letter-spacing: 1px; background: rgba(37,99,235,0.08); display: inline-block; padding: 4px 8px; border-radius: 6px; }

    /* é€‰é¡¹æ ·å¼ä¼˜åŒ–
    .scale{ display:grid; grid-template-columns: repeat(6, 1fr); gap:6px; background: var(--surface-2); padding: 6px; border-radius: 16px; border: 1px solid var(--line); }
    .opt label{ display:flex; align-items:center; justify-content:center; height: 44px; border-radius: 12px; background: transparent; cursor: pointer; transition: all 0.2s; font-weight: 600; color: var(--muted); font-size: 14px; }
    .opt label:hover{ background: rgba(255,255,255,0.5); }
    .opt input{ display:none; }
    
    /* é€‰ä¸­æ€ */
    /* .opt input:checked + label{ background: #fff; color: var(--brand); box-shadow: 0 4px 12px rgba(0,0,0,0.08); font-weight: 800; transform: scale(1.05); } */

    .scale-ends{ display:flex; justify-content:space-between; font-size: 12px; color: var(--muted-light); margin-top: 8px; padding: 0 4px; font-weight: 500; }

    .btn{ width:100%; padding: 16px; border-radius: 16px; background: var(--brand); color: #fff; border:none; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 10px 20px rgba(37,99,235,0.2); transition: all 0.2s; }
    .btn:active{ transform: scale(0.98); } 

    /* =========================================
       16P é£æ ¼æ‰“åˆ†æ¡æ ·å¼ (UI ä¿®å¤ç‰ˆ)
       ========================================= */
    .scale-wrapper {
      width: 100%;
      padding: 20px 0;
      /* é˜²æ­¢åœ¨çª„å±ä¸‹å‡ºç°æ»šåŠ¨æ¡ */
      overflow-x: visible; 
    }

    /* æ ¸å¿ƒå®¹å™¨ï¼šå¼ºåˆ¶ä¸€è¡Œæ’åˆ—ï¼Œå‚ç›´å±…ä¸­ */
    .scale-container {
      display: flex;
      align-items: center;
      justify-content: center; /* æ•´ä½“å±…ä¸­ */
      gap: 30px;               /* æ–‡å­—å’Œåœ†åœˆç»„çš„è·ç¦» */
      margin: 0 auto;
      max-width: 750px;        /* é™åˆ¶æœ€å¤§å®½åº¦ï¼Œé˜²æ­¢å¤ªæ•£ */
    }

    /* æ–‡å­—æ ‡ç­¾æ ·å¼ */
    .label-text {
      font-size: 14px;
      font-weight: 700;
      white-space: nowrap; /* ç¦æ­¢æ–‡å­—æ¢è¡Œ */
      flex-shrink: 0;      /* ç¦æ­¢æ–‡å­—è¢«å‹ç¼© */
    }
    .label-agree { color: #33c6a9; }
    .label-disagree { color: #88619a; }

    /* ä¸­é—´åœ†åœˆçš„å®¹å™¨ */
    .scale-options {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px; /* åœ†åœˆä¹‹é—´çš„é—´è· */
    }

    /* éšè—åŸç”Ÿ Radio */
    .opt-radio input { display: none; }

    /* åœ†åœˆåŸºç¡€æ ·å¼ */
    .opt-radio label {
      display: block;
      border-radius: 50%;
      border: 2px solid; 
      background: transparent;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      box-sizing: border-box; /* ç¡®ä¿è¾¹æ¡†ç®—åœ¨å¤§å°å†… */
    }

    /* é€‰ä¸­æ—¶çš„å¯¹å‹¾å›¾æ ‡ */
    .opt-radio label::after {
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0);
      width: 50%; height: 50%;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='20 6 9 17 4 12'%3E%3C/polyline%3E%3C/svg%3E");
      background-size: contain;
      background-repeat: no-repeat;
      transition: transform 0.2s ease;
    }
    /* é€‰ä¸­çŠ¶æ€ï¼šæ˜¾ç¤ºå¯¹å‹¾ */
    .opt-radio input:checked + label::after {
      transform: translate(-50%, -50%) scale(1);
    }


    .size-lg label { width: 50px; height: 50px; }
    .size-md label { width: 40px; height: 40px; }
    .size-sm label { width: 30px; height: 30px; }

    /* ------- é¢œè‰²å®šä¹‰ ------- */
    /* åŒæ„ç³» (ç»¿è‰²) */
    .color-agree label { border-color: #33c6a9; color: #33c6a9; }
    .color-agree input:checked + label {
      background-color: #33c6a9;
      box-shadow: 0 0 0 4px rgba(51, 198, 169, 0.2);
    }
    
    /* åå¯¹ç³» (ç´«è‰²) */
    .color-disagree label { border-color: #88619a; color: #88619a; }
    .color-disagree input:checked + label {
      background-color: #88619a;
      box-shadow: 0 0 0 4px rgba(136, 97, 154, 0.2);
    }

    /* Hover æ•ˆæœ */
    .opt-radio label:hover { border-width: 3px; transform: scale(1.05); }

    /* ============================
       ç§»åŠ¨ç«¯é€‚é… (é‡ç‚¹ä¿®å¤)
       ============================ */
    @media(max-width: 480px) {
      .scale-container {
        gap: 8px; /* ç¼©å°æ–‡å­—å’Œåœ†åœˆçš„è·ç¦» */
        width: 100%;
        padding: 0 4px;
      }
      .scale-options {
        gap: 6px; /* ç¼©å°åœ†åœˆé—´è· */
      }
      .label-text { font-size: 12px; }

      /* æ•´ä½“ç¼©å°åœ†åœˆå°ºå¯¸ï¼Œé˜²æ­¢æ¢è¡Œ */
      .size-lg label { width: 34px; height: 34px; }
      .size-md label { width: 26px; height: 26px; }
      .size-sm label { width: 20px; height: 20px; }
    }


    /* ç»“æœé¡µç½‘æ ¼ */
    #result{ display: none; padding-bottom: 60px; }
    .grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-top: 20px; }
    @media(min-width: 640px){ .grid{ grid-template-columns: repeat(3, 1fr); } }
    
    .stat{ background: #fff; padding: 20px; border-radius: 18px; box-shadow: var(--shadow); border: 1px solid rgba(255,255,255,0.5); display:flex; flex-direction:column; align-items: center; text-align: center; }
    .stat .k{ font-size: 12px; font-weight: 700; color: var(--muted-light); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
    .stat .v{ font-family: "Noto Serif SC", serif; font-size: 20px; font-weight: 700; margin-bottom: 6px; }
    .stat .d{ font-size: 12px; color: var(--muted); line-height: 1.4; }

    .color-high{ color: #7c3aed; }
    .color-mid{ color: #2563eb; }
    .color-low{ color: #64748b; }
    .color-healthy{ color: #16a34a; }
    .color-warn{ color: #d97706; }
    .color-bad{ color: #dc2626; }

    /* å›¾è¡¨å’Œå»ºè®® */
    .chart-box, .section{ background: #fff; padding: 24px; border-radius: 20px; margin-top: 16px; box-shadow: var(--shadow); }
    .section h3{ margin: 0 0 12px; font-size: 16px; font-weight: 700; display:flex; align-items:center; gap:8px; }
    .section h3::before{ content:''; width: 4px; height: 16px; background: var(--brand); border-radius: 4px; }
    .section p{ margin: 0; font-size: 15px; line-height: 1.7; color: var(--muted); text-align: justify; }

    /* Loading & Toast */
    .loading-overlay{ position: fixed; inset: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(5px); z-index: 100; display:none; flex-direction: column; align-items:center; justify-content:center; }
    .spinner{ width: 40px; height: 40px; border: 4px solid #e2e8f0; border-top-color: var(--brand); border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 16px; }
    .toast{ position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #1e293b; color: #fff; padding: 12px 24px; border-radius: 99px; font-size: 14px; font-weight: 500; z-index: 200; display:none; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }

    @keyframes spin{ to{ transform: rotate(360deg); } }
    @keyframes fadeIn{ from{ opacity:0; transform:translateY(10px); } to{ opacity:1; transform:translateY(0); } }
    @keyframes slideUp{ from{ opacity:0; transform:translateY(20px); } to{ opacity:1; transform:translateY(0); } }
    /* æ–°å¢ï¼šç©ºçŠ¶æ€/å»ºè®¾ä¸­æ ·å¼ */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
      animation: fadeIn 0.5s;
    }
    .empty-icon {
      font-size: 48px;
      margin-bottom: 16px;
      display: block;
      opacity: 0.5;
    }
    .empty-text {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .empty-sub {
      font-size: 13px;
      opacity: 0.8;
    }
    .guide-card {
      background: #fff;
      border-radius: 20px;
      padding: 0; /* å†…éƒ¨å¸ƒå±€è‡ªå·±æ§åˆ¶ */
      margin-top: 24px;
      box-shadow: 0 10px 30px -10px rgba(37, 99, 235, 0.15); /* è“è‰²ç³»æŠ•å½± */
      border: 1px solid #eff6ff;
      overflow: hidden;
    }

    /* é¡¶éƒ¨æ ‡é¢˜æ  */
    .guide-header {
      background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
      padding: 20px 24px;
      border-bottom: 1px solid #bfdbfe;
    }
    
    .guide-tag {
      display: inline-block;
      background: #2563eb;
      color: #fff;
      font-size: 11px;
      font-weight: 800;
      padding: 4px 10px;
      border-radius: 99px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
    }

    .guide-title {
      font-size: 20px; /* å¤§æ ‡é¢˜ */
      font-weight: 800;
      color: #1e3a8a;  /* æ·±è“ */
      margin: 0;
      line-height: 1.4;
      font-family: "Noto Serif SC", serif; /* è¡¬çº¿ä½“æ›´æœ‰è´¨æ„Ÿ */
    }

    /* å†…å®¹åŒºåŸŸ */
    .guide-body {
      padding: 24px;
    }

    /* è‡ªåŠ¨ç”Ÿæˆçš„æ®µè½å— */
    .guide-block {
      margin-bottom: 20px;
    }
    .guide-block:last-child { margin-bottom: 0; }

    /* å°æ ‡é¢˜ (å³ã€XXXã€‘çš„å†…å®¹) */
    .guide-sub-title {
      font-size: 15px;
      font-weight: 700;
      color: #2563eb;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    /* ç»™å°æ ‡é¢˜åŠ ä¸ªè£…é¥°æ€§ç«–çº¿ */
    .guide-sub-title::before {
      content: '';
      display: block;
      width: 4px;
      height: 14px;
      background: #2563eb;
      border-radius: 2px;
    }

    /* æ­£æ–‡æ–‡å­— */
    .guide-text {
      font-size: 14px;
      line-height: 1.8; /* å¢åŠ è¡Œé«˜ï¼Œé˜…è¯»ä¸ç´¯ */
      color: #475569;
      text-align: justify; /* ä¸¤ç«¯å¯¹é½ */
    }
    
    /* ç‰¹æ®Šå¤„ç†ï¼šé«˜äº®åŸæœ¬çš„ 1. 2. 3. */
    .guide-text b {
      color: #0f172a;
      font-weight: 700;
      background: #f1f5f9;
      padding: 0 4px;
      border-radius: 4px;
      margin-right: 4px;
    }
    .guide-block {
      margin-bottom: 16px; /* ç¨å¾®è°ƒå°ä¸€ç‚¹ */
    }
    
    /* è§£å†³ç©ºè¡Œå¯¼è‡´çš„é¢å¤–é«˜åº¦ */
    .guide-text {
      font-size: 14px;
      line-height: 1.8;
      color: #475569;
      text-align: justify;
    }
    

    /* æ¯ä¸€ä¸ªã€æ ‡é¢˜+æ­£æ–‡ã€‘éƒ½æ˜¯ä¸€ä¸ª guide-block */
    .guide-block {
      /* å—å†…éƒ¨ä¸ç”¨è®¾å¤ªå¤§ï¼Œä¸»è¦é  margin-top æ¨å¼€ä¸Šé¢çš„å— */
      margin-bottom: 0; 
    }

    /* ã€æ ¸å¿ƒä¿®å¤ã€‘ */
    /* åªè¦ä¸€ä¸ª block å‰é¢è¿˜æœ‰å¦ä¸€ä¸ª blockï¼Œå°±ç»™å®ƒé¡¶éƒ¨åŠ  32px çš„è·ç¦» */
    /* è¿™ä¼šè®© "æœªæ¥30å¤©æ€ä¹ˆè¿‡" ç¦»ä¸Šé¢é‚£æ®µè¯è¿œè¿œçš„ */
    .guide-block + .guide-block {
      margin-top: 32px; 
      padding-top: 16px; /* é¢å¤–åŠ ä¸€ç‚¹å†…è¾¹è·ä½œä¸ºç¼“å†² */
      border-top: 1px dashed #e2e8f0; /* (å¯é€‰) åŠ ä¸€æ¡è™šçº¿åˆ†å‰²çº¿ï¼Œè§†è§‰æ›´æ¸…æ™° */
    }

    /* å°æ ‡é¢˜æ ·å¼ */
    .guide-sub-title {
      font-size: 16px; /* ç¨å¾®åŠ å¤§ä¸€ç‚¹ */
      font-weight: 800;
      color: #1e40af;  /* æ·±ä¸€ç‚¹çš„è“ */
      margin-bottom: 12px; /* è®©æ ‡é¢˜ç¦»ä¸‹é¢çš„æ­£æ–‡è¿œä¸€ç‚¹ */
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* æ ‡é¢˜å‰çš„è£…é¥°ç«–çº¿ */
    .guide-sub-title::before {
      content: '';
      display: block;
      width: 4px;
      height: 16px;
      background: #3b82f6;
      border-radius: 4px;
    }

    /* æ­£æ–‡æ ·å¼ */
    .guide-text {
      font-size: 14px;
      line-height: 1.8; /* è¡Œé«˜åŠ å¤§ï¼Œé˜…è¯»æ›´èˆ’æœ */
      color: #334155;
      text-align: justify;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand" onclick="location.reload()">
        <div class="logo">M</div>
        <div class="brand-text">å¿ƒç†çŠ¶æ€ç½—ç›˜</div>
      </div>
      
      <div class="status-capsule" id="status-bar">
        æ­£åœ¨åˆ†æ <span id="current-type-label">INTP</span>
        <button class="btn-change" onclick="resetApp()">åˆ‡æ¢</button>
      </div>
    </div>
  </div>

  <div id="loading" class="loading-overlay">
    <div class="spinner"></div>
    <div style="font-size:14px; font-weight:600; color:#64748b; letter-spacing: 1px;">æ­£åœ¨è¿æ¥ç½—ç›˜...</div>
  </div>

  <div class="container">
    
    <div id="landing-page">
      <div class="hero">
        <h1>ä½ çš„èƒ½é‡ï¼Œå¤„äºä»€ä¹ˆç›¸ä½ï¼Ÿ</h1>
        <p>åŸºäºè£æ ¼å…«ç»´è®¤çŸ¥åŠŸèƒ½æ¨¡å‹ï¼Œç²¾å‡†æ¢æµ‹ä½ å½“ä¸‹çš„å†…è€—ç¨‹åº¦ã€å‹åŠ›ååº”ä¸å¿ƒç†æ•ˆèƒ½ã€‚</p>
      </div>

      <div class="group-title" style="color:#8b5cf6">ğŸŸ£ Analysts åˆ†æå®¶</div>
      <div class="type-grid">
        <button class="type-card nt-card" data-type="INTJ" onclick="selectType('INTJ')">
          <strong>INTJ</strong><span>å»ºç­‘å¸ˆ</span>
        </button>
        <button class="type-card nt-card" data-type="INTP" onclick="selectType('INTP')">
          <strong>INTP</strong><span>é€»è¾‘å­¦å®¶</span>
        </button>
        <button class="type-card nt-card" data-type="ENTJ" onclick="selectType('ENTJ')">
          <strong>ENTJ</strong><span>æŒ‡æŒ¥å®˜</span>
        </button>
        <button class="type-card nt-card" data-type="ENTP" onclick="selectType('ENTP')">
          <strong>ENTP</strong><span>è¾©è®ºå®¶</span>
        </button>
      </div>

      <div class="group-title" style="color:#10b981">ğŸŸ¢ Diplomats å¤–äº¤å®¶</div>
      <div class="type-grid">
        <button class="type-card nf-card" data-type="INFJ" onclick="selectType('INFJ')">
          <strong>INFJ</strong><span>æå€¡è€…</span>
        </button>
        <button class="type-card nf-card" data-type="INFP" onclick="selectType('INFP')">
          <strong>INFP</strong><span>è°ƒåœè€…</span>
        </button>
        <button class="type-card nf-card" data-type="ENFJ" onclick="selectType('ENFJ')">
          <strong>ENFJ</strong><span>ä¸»äººå…¬</span>
        </button>
        <button class="type-card nf-card" data-type="ENFP" onclick="selectType('ENFP')">
          <strong>ENFP</strong><span>ç«é€‰è€…</span>
        </button>
      </div>

      <div class="group-title" style="color:#3b82f6">ğŸ”µ Sentinels å®ˆæŠ¤è€…</div>
      <div class="type-grid">
        <button class="type-card sj-card" data-type="ISTJ" onclick="selectType('ISTJ')">
          <strong>ISTJ</strong><span>ç‰©æµå¸ˆ</span>
        </button>
        <button class="type-card sj-card" data-type="ISFJ" onclick="selectType('ISFJ')">
          <strong>ISFJ</strong><span>å®ˆå«è€…</span>
        </button>
        <button class="type-card sj-card" data-type="ESTJ" onclick="selectType('ESTJ')">
          <strong>ESTJ</strong><span>æ€»ç»ç†</span>
        </button>
        <button class="type-card sj-card" data-type="ESFJ" onclick="selectType('ESFJ')">
          <strong>ESFJ</strong><span>æ‰§æ”¿å®˜</span>
        </button>
      </div>

      <div class="group-title" style="color:#f59e0b">ğŸŸ¡ Explorers æ¢é™©å®¶</div>
      <div class="type-grid">
        <button class="type-card sp-card" data-type="ISTP" onclick="selectType('ISTP')">
          <strong>ISTP</strong><span>é‰´èµå®¶</span>
        </button>
        <button class="type-card sp-card" data-type="ISFP" onclick="selectType('ISFP')">
          <strong>ISFP</strong><span>æ¢é™©å®¶</span>
        </button>
        <button class="type-card sp-card" data-type="ESTP" onclick="selectType('ESTP')">
          <strong>ESTP</strong><span>ä¼ä¸šå®¶</span>
        </button>
        <button class="type-card sp-card" data-type="ESFP" onclick="selectType('ESFP')">
          <strong>ESFP</strong><span>è¡¨æ¼”è€…</span>
        </button>
      </div>
      
      
      <div style="margin-top:40px; text-align:center; color:var(--muted); font-size:12px; opacity:0.6;">
        MBTI State Compass v2.0
      </div>
    </div>

    <div id="quiz-interface">
      <div class="q-progress-box" id="q-progress-box">
        <div class="progress-text" id="progress-text">0/0</div>
        <div class="progress-track">
          <div class="progress-fill" id="progress-bar"></div>
        </div>
      </div>

      <form id="quiz-form">
        <div id="questions-container"></div>
        <button type="submit" class="btn" id="submit-btn" style="margin-top:20px;">ç”Ÿæˆæ·±åº¦æŠ¥å‘Š</button>
      </form>

      <div id="result">
        <div class="grid">
          <div class="stat"><div class="k">è®¤çŸ¥æˆç†Ÿåº¦</div><div class="v" id="v-maturity">-</div><div class="d" id="d-maturity">-</div></div>
          <div class="stat"><div class="k">å†…è€—å€¾å‘ Loop</div><div class="v" id="v-loop">-</div><div class="d" id="d-loop">-</div></div>
          <div class="stat"><div class="k">å‹åŠ›ååº” Grip</div><div class="v" id="v-grip">-</div><div class="d" id="d-grip">-</div></div>
          <div class="stat"><div class="k">å‹åŠ›è´Ÿè· Load</div><div class="v" id="v-load">-</div><div class="d" id="d-load">-</div></div>
          <div class="stat"><div class="k">è‡ªæ´½åº¦</div><div class="v" id="v-coherence">-</div><div class="d" id="d-coherence">-</div></div>
          <div class="stat"><div class="k">çŠ¶æ€æŒ‡æ•°</div><div class="v" id="v-overall">-</div><div class="d" id="d-overall">-</div></div>
        </div>
        
        <div class="chart-box">
          <div style="width:100%; height:320px; position:relative;">
            <canvas id="radarChart"></canvas>
          </div>
        </div>

        <div class="section"><h3>æ ¸å¿ƒæ´å¯Ÿ</h3><p id="res-insight">...</p></div>
        <div class="section"><h3>è°ƒæ•´å»ºè®®</h3><p id="res-advice">...</p></div>
        <div class="section month-card">
        <div class="guide-card" id="guide-card-container" style="display:none">
          <div class="guide-header">
            <div class="guide-tag">ğŸ“… æœªæ¥30å¤©æŒ‡å—</div>
            <h3 class="guide-title" id="res-month-title">æ­£åœ¨ç”Ÿæˆæ–¹æ¡ˆ...</h3>
          </div>
          <div class="guide-body" id="res-month-body">
            </div>
        </div>

        <button class="btn btn-ghost" onclick="resetApp()" style="margin-top:30px; background:#f1f5f9; color:#475569;">é‡æ–°æµ‹è¯•</button>
      </div>
    </div>

  </div>

  <div id="toast" class="toast"></div>

  <script>
    let currentQuestions = [];
    let currentType = "";
    let myChart = null;

    // é…ç½®ï¼šæœ¬åœ°è°ƒè¯• vs çº¿ä¸Š
    const IS_LOCAL = window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost';
    const API_BASE = IS_LOCAL ? 'http://127.0.0.1:8000' : '';
    
    const $ = (id) => document.getElementById(id);
    const setLoading = (show) => { $('loading').style.display = show ? 'flex' : 'none'; };
    const toast = (msg) => {
      const t = $('toast'); t.textContent = msg; t.style.display = 'block'; t.style.animation = 'fadeIn 0.3s';
      setTimeout(() => t.style.display = 'none', 3000);
    };

    // é€‰æ‹©ç±»å‹å…¥å£
// ==========================================

    function selectType(type) {
      currentType = type;
      $('current-type-label').textContent = type;
      
      // UI åˆ‡æ¢
      $('landing-page').style.display = 'none';
      $('quiz-interface').style.display = 'block';
      $('status-bar').style.display = 'flex';
      
      fetchQuestions(type);
    }

    // ==========================================
    // ä¿®æ”¹ 3: å‡çº§ fetchQuestions å‡½æ•° (å¤„ç†ç©ºé¢˜åº“)
    // ==========================================
    async function fetchQuestions(type) {
      setLoading(true);
      const container = $('questions-container'); // è·å–å®¹å™¨
      $('submit-btn').style.display = 'none'; // å…ˆéšè—æäº¤æŒ‰é’®ï¼Œæœ‰é¢˜ç›®å†æ˜¾ç¤º
      
      try {
        const res = await fetch(`${API_BASE}/api/questions/${type}`);
        
        // å¦‚æœåç«¯æŠ¥é”™ï¼Œæˆ–è€…è¿”å›ä¸æ˜¯ 200
        if (!res.ok) throw new Error("API Error");
        
        currentQuestions = await res.json();

        // ã€å…³é”®é€»è¾‘ã€‘æ£€æŸ¥é¢˜ç›®æ•°é‡
        if (!currentQuestions || currentQuestions.length === 0) {
          renderEmptyState(type); // æ¸²æŸ“â€œå»ºè®¾ä¸­â€ç•Œé¢
        } else {
          renderQuestions();      // æ­£å¸¸æ¸²æŸ“é¢˜ç›®
          $('submit-btn').style.display = 'block'; // æ˜¾ç¤ºæäº¤æŒ‰é’®
        }

      } catch (err) {
        console.error(err);
        // å¦‚æœæ˜¯ç½‘ç»œé”™è¯¯ï¼Œä¹Ÿæ˜¾ç¤ºä¸€ä¸ªå‹å¥½çš„é‡è¯•ç•Œé¢ï¼Œè€Œä¸æ˜¯å•çº¯ Toast
        container.innerHTML = `
          <div class="empty-state">
            <span class="empty-icon">ğŸ“¡</span>
            <div class="empty-text">è¿æ¥ä¿¡å·å¾®å¼±</div>
            <div class="empty-sub">æ— æ³•è·å–é¢˜ç›®æ•°æ®ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åç«¯æœåŠ¡</div>
            <button class="btn btn-ghost" onclick="fetchQuestions('${type}')" style="margin-top:20px; width:auto;">ç‚¹å‡»é‡è¯•</button>
          </div>
        `;
      } finally {
        setLoading(false);
      }
    }

    // ==========================================
    // æ–°å¢: æ¸²æŸ“â€œé¢˜åº“è®¾è®¡ä¸­â€ç•Œé¢çš„å‡½æ•°
    // ==========================================
    function renderEmptyState(type) {
      const container = $('questions-container');
      container.innerHTML = `
        <div class="empty-state">
          <span class="empty-icon">â˜•ï¸</span>
          <div class="empty-text">${type} æ·±åº¦é¢˜åº“è®¾è®¡ä¸­</div>
          <div class="empty-sub">
            æˆ‘ä»¬çš„å¿ƒç†å­¦ä¸“å®¶æ­£åœ¨æ¢³ç† ${type} çš„è®¤çŸ¥åŠŸèƒ½æ¨¡å‹ã€‚<br>
            ä¸ºäº†ä¿è¯æµ‹è¯•ç²¾åº¦ï¼Œè¯·å†ç»™æˆ‘ä»¬ä¸€ç‚¹æ—¶é—´ã€‚
          </div>
          <button class="btn btn-ghost" onclick="resetApp()" style="margin-top:24px; width:auto;">è¿”å›é€‰æ‹©å…¶ä»–ç±»å‹</button>
        </div>
      `;
    }

    // é‡ç½®å›é¦–é¡µ
    function resetApp() {
      $('quiz-interface').style.display = 'none';
      $('landing-page').style.display = 'block';
      $('landing-page').style.animation = 'fadeIn 0.5s ease';
      $('status-bar').style.display = 'none';
      $('result').style.display = 'none';
      $('quiz-form').style.display = 'block';
      currentQuestions = [];
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function fetchQuestions(type) {
      setLoading(true);
      try {
        const res = await fetch(`${API_BASE}/api/questions/${type}`);
        if (!res.ok) throw new Error("API Error");
        currentQuestions = await res.json();
        renderQuestions();
      } catch (err) {
        console.error(err);
        toast("è¿æ¥æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
        setTimeout(resetApp, 2000); // å¤±è´¥åè¿”å›é¦–é¡µ
      } finally {
        setLoading(false);
      }
    }

function renderQuestions() {
      const container = $('questions-container');
      container.innerHTML = "";
      updateProgress();

      currentQuestions.forEach((q, idx) => {
        const card = document.createElement('div');
        card.className = 'card';
        card.dataset.qid = q.id;
        
        // å®šä¹‰æ¯ä¸ªåˆ†æ•°çš„æ ·å¼é…ç½®
        // 6åˆ†=æœ€å·¦è¾¹(å¤§ç»¿), 1åˆ†=æœ€å³è¾¹(å¤§ç´«)
        const styles = {
          6: { size: 'size-lg', color: 'color-agree' },
          5: { size: 'size-md', color: 'color-agree' },
          4: { size: 'size-sm', color: 'color-agree' },
          3: { size: 'size-sm', color: 'color-disagree' },
          2: { size: 'size-md', color: 'color-disagree' },
          1: { size: 'size-lg', color: 'color-disagree' }
        };

        // ç”Ÿæˆä¸­é—´åœ†åœˆ HTML
        let circlesHtml = '';
        for (let i = 6; i >= 1; i--) {
          const s = styles[i];
          circlesHtml += `
            <div class="opt-radio ${s.size} ${s.color}">
              <input type="radio" name="q${q.id}" id="q${q.id}_${i}" value="${i}">
              <label for="q${q.id}_${i}"></label>
            </div>
          `;
        }

        // ç»„è£… HTML
        card.innerHTML = `
          <div class="qmeta">Q${idx + 1}</div>
          <div class="qtext">${q.text}</div>
          
          <div class="scale-wrapper">
            <div class="scale-container">
              <span class="label-text label-agree">åŒæ„</span>
              <div class="scale-options">
                ${circlesHtml}
              </div>
              <span class="label-text label-disagree">åå¯¹</span>
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });

      // é‡æ–°ç»‘å®šäº‹ä»¶ç›‘å¬
      $('quiz-form').addEventListener('change', updateProgress);
    }

    function updateProgress() {
      const data = new FormData($('quiz-form'));
      let count = 0; for(let pair of data.entries()) count++;
      const total = currentQuestions.length;
      
      const percent = total === 0 ? 0 : (count / total) * 100;
      $('progress-bar').style.width = `${percent}%`;
      $('progress-text').textContent = `${count}/${total}`;
    }

    async function submitAnswers(answersMap) {
          setLoading(true);
          let resultData = null;

          // ç¬¬ä¸€æ­¥ï¼šåªè´Ÿè´£æ‹¿æ•°æ®ï¼ˆç½‘ç»œå±‚ï¼‰
          try {
            const res = await fetch(`${API_BASE}/api/submit`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ mbti: currentType, answers: answersMap })
            });
            
            if (!res.ok) {
              throw new Error(`HTTP error! status: ${res.status}`);
            }
            
            resultData = await res.json();
            
          } catch (err) {
            console.error("ç½‘ç»œè¯·æ±‚å¤±è´¥:", err);
            toast("ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥åç«¯");
            setLoading(false);
            return; // ç½‘ç»œé”™äº†å°±åœåœ¨è¿™é‡Œ
          }

          // ç¬¬äºŒæ­¥ï¼šæ‹¿åˆ°æ•°æ®åï¼Œè´Ÿè´£ç”»ç•Œé¢ï¼ˆæ¸²æŸ“å±‚ï¼‰
          // è¿™éƒ¨åˆ†å¦‚æœæœ‰é”™ï¼Œä¼šåœ¨æ§åˆ¶å°ç›´æ¥çº¢å­—æŠ¥é”™ï¼Œè€Œä¸ä¼šæŠ¥â€œè¶…æ—¶â€
          try {
            console.log("åç«¯è¿”å›çš„æ•°æ®:", resultData); // æ‰“å°æ•°æ®ç¡®è®¤
            renderResult(resultData);
          } catch (err) {
            console.error("ç•Œé¢æ¸²æŸ“å¤±è´¥:", err);
            alert("ç•Œé¢æ˜¾ç¤ºå‡ºé”™äº†ï¼è¯·çœ‹æ§åˆ¶å°æŠ¥é”™ä¿¡æ¯ã€‚\né”™è¯¯åŸå› : " + err.message);
          } finally {
            setLoading(false);
          }
        }

function renderResult(data) {
      // 1. åˆ‡æ¢ç•Œé¢æ˜¾ç¤º
      $('quiz-form').style.display = 'none';
      if($('q-progress-box')) $('q-progress-box').style.display = 'none'; // å®‰å…¨éšè—è¿›åº¦æ¡
      $('result').style.display = 'block';
      $('result').style.animation = 'fadeIn 0.5s ease';
      window.scrollTo({ top: 0, behavior: 'smooth' });

      // 2. å¡«å……åŸºç¡€æ•°æ®çš„è¾…åŠ©å‡½æ•°
      const fill = (id, val, desc, className) => {
        const el = $(id);
        if(el) {
            el.innerHTML = val;
            el.className = `v ${className}`;
            const descEl = $(`d-${id.split('-')[1]}`);
            if(descEl) descEl.textContent = desc;
        }
      };

      // --- å¡«å……å…­ç»´æ•°æ® ---
      
      // 1. è®¤çŸ¥æˆç†Ÿåº¦
      let mClass = data.maturity >= 67 ? "color-high" : (data.maturity >= 34 ? "color-mid" : "color-low");
      let mTxt = data.maturity >= 67 ? "é«˜é˜¶ Â· æ•´åˆè€…" : (data.maturity >= 34 ? "ä¸­é˜¶ Â· æ¢ç´¢è€…" : "ä½é˜¶ Â· å›ºå®ˆè€…");
      let mDesc = data.maturity >= 67 ? "æ€ç»´ä¸ç°å®æ•´åˆåº¦é«˜" : (data.maturity >= 34 ? "æ€è·¯æˆå½¢ï¼ŒæŒç»­è¿­ä»£" : "æ˜“è¢«æ—§æ¨¡å¼ç‰µå¼•");
      fill('v-maturity', mTxt, mDesc, mClass);

      // 2. Loop
      let lClass = data.loop < 35 ? "color-healthy" : (data.loop < 65 ? "color-warn" : "color-bad");
      let lTxt = data.loop < 35 ? "ä½" : (data.loop < 65 ? "ä¸­" : "é«˜");
      let lDesc = data.loop < 35 ? "å¯åŠ¨æˆæœ¬ä½" : (data.loop < 65 ? "å¶æœ‰ç²¾ç¥ååˆ" : "è‡ªæˆ‘æ”»å‡»ä¸¥é‡");
      fill('v-loop', lTxt, lDesc, lClass);

      // 3. Grip
      let gClass = data.grip < 35 ? "color-healthy" : (data.grip < 65 ? "color-warn" : "color-bad");
      let gTxt = data.grip < 35 ? "ä½" : (data.grip < 65 ? "ä¸­" : "é«˜");
      let gDesc = data.grip < 35 ? "æƒ…ç»ªç¨³å®š" : (data.grip < 65 ? "å‹åŠ›ä¸‹å¶æœ‰çˆ†å‘" : "å¤„åœ¨é«˜å‹è¾¹ç¼˜");
      fill('v-grip', gTxt, gDesc, gClass);

      // 4. Load
      let ldClass = data.load < 35 ? "color-healthy" : (data.load < 65 ? "color-warn" : "color-bad");
      let ldTxt = data.load < 35 ? "è½»" : (data.load < 65 ? "ä¸­" : "é‡");
      let ldDesc = data.load < 35 ? "ä½™é‡å……è¶³" : (data.load < 65 ? "å¼ºåº¦é€‚ä¸­" : "æ€¥éœ€å‡è´Ÿæ¢å¤");
      fill('v-load', ldTxt, ldDesc, ldClass);

      // 5. è‡ªæ´½åº¦
      let cClass = data.coherence >= 70 ? "color-high" : (data.coherence >= 55 ? "color-mid" : "color-warn");
      let cTxt = data.coherence >= 70 ? "é«˜" : (data.coherence >= 55 ? "ä¸­" : "ä½");
      let cDesc = data.coherence >= 70 ? "å†…åœ¨é€»è¾‘æ¸…æ™°" : (data.coherence >= 55 ? "å¯è‡ªæˆ‘æ ¡å‡†" : "è¿‘æœŸæ‘‡æ‘†è¾ƒå¤š");
      fill('v-coherence', cTxt, cDesc, cClass);

      // 6. æ€»åˆ†
      let oClass = data.overall >= 75 ? "color-high" : (data.overall >= 55 ? "color-healthy" : (data.overall >= 35 ? "color-warn" : "color-bad"));
      fill('v-overall', `${data.pill_text} <span style="font-size:14px">${data.overall}</span>`, "ç»¼åˆå¿ƒç†æ•ˆèƒ½", oClass);

      // --- å¡«å……æ ¸å¿ƒæ´å¯Ÿä¸å»ºè®® ---
      $('res-insight').textContent = data.insight;
      $('res-advice').textContent = data.advice;


      // --- ã€é‡ç‚¹ã€‘å¤„ç†æœªæ¥30å¤©æŒ‡å— (ç¾åŒ–æ’ç‰ˆé€»è¾‘) ---
      
      // 1. ç¡®ä¿ HTML é‡Œæœ‰è¿™ä¸ªå®¹å™¨ï¼Œé˜²æ­¢æŠ¥é”™
      const guideContainer = $('guide-card-container');
      
      if (guideContainer && data.month_text) {
          guideContainer.style.display = 'block'; // æ˜¾ç¤ºå¡ç‰‡
          
          // å¡«å……æ ‡é¢˜
          if($('res-month-title')) $('res-month-title').textContent = data.month_title;


          let rawText = data.month_text || "";
          rawText = rawText.trim();
          
          // 1. å¼ºåŠ›å»é™¤æ ‡é¢˜å‰åçš„å¹²æ‰°æ¢è¡Œ
          rawText = rawText.replace(/\n\s*ã€/g, 'ã€').replace(/ã€‘\s*\n/g, 'ã€‘');

          let formattedHtml = rawText;

          // 2. ã€å…³é”®ä¿®æ”¹ã€‘ç”Ÿæˆ HTML ç»“æ„
          // æ³¨æ„è¿™é‡Œï¼šç”¨äº†ä¸¤ä¸ª </div></div> 
          // ç¬¬ä¸€ä¸ªå…³æ‰ guide-textï¼Œç¬¬äºŒä¸ªå…³æ‰ guide-blockï¼Œç¡®ä¿å¤§å®¶æ˜¯å¹³çº§çš„å…„å¼Ÿå…³ç³»
          formattedHtml = formattedHtml.replace(/ã€(.*?)ã€‘/g, (match, title) => {
            return `</div></div><div class="guide-block"><div class="guide-sub-title">${title}</div><div class="guide-text">`;
          });

          // 3. æ¸…ç†å¼€å¤´å¤šä½™çš„é—­åˆæ ‡ç­¾
          // å› ä¸ºç¬¬ä¸€æ®µå‰é¢æ²¡æœ‰ç›’å­éœ€è¦å…³é—­ï¼Œæ‰€ä»¥æ­£åˆ™æ›¿æ¢æ‰å¼€å¤´çš„ </div>
          formattedHtml = formattedHtml.replace(/^(<\/div>)+/, '');

          // 4. è¡¥ä¸Šæœ€åçš„é—­åˆæ ‡ç­¾
          formattedHtml += '</div></div>';

          // 5. å¤„ç†åˆ—è¡¨é¡¹ (1. 2. 3.)
          formattedHtml = formattedHtml.replace(/(?:^|<br>|\n|\s)(\d+\.)/g, '<br><span class="guide-num">$1</span>');
          
          // 6. å¤„ç†å‰©ä½™æ¢è¡Œ
          formattedHtml = formattedHtml.replace(/\n/g, '<br>');
          if (formattedHtml.startsWith('<br>')) formattedHtml = formattedHtml.substring(4);

          // å¡«å……è¿› HTML
          if($('res-month-body')) $('res-month-body').innerHTML = formattedHtml;



      }


      // --- ç»˜åˆ¶é›·è¾¾å›¾ ---
      const ctx = $('radarChart').getContext('2d');
      if(myChart) myChart.destroy();
      
      // åŠ¨æ€è·å–CSSå˜é‡é¢œè‰²
      const style = getComputedStyle(document.body);
      const brandColor = style.getPropertyValue('--brand').trim() || '#2563eb'; // ç»™ä¸ªé»˜è®¤å€¼é˜²æ­¢è·å–å¤±è´¥

      myChart = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: ['è®¤çŸ¥æˆç†Ÿåº¦', 'è‡ªæ´½åº¦', 'å†…è€—å¼¹æ€§', 'å‹åŠ›å¼¹æ€§', 'è´Ÿè·ä½™é‡', 'çŠ¶æ€æŒ‡æ•°'],
          datasets: [{
            label: 'å½“å‰çŠ¶æ€',
            data: data.chart_data,
            backgroundColor: 'rgba(37, 99, 235, 0.2)',
            borderColor: brandColor,
            borderWidth: 2,
            pointBackgroundColor: '#fff',
            pointBorderColor: brandColor,
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            r: {
              min: 0, max: 100,
              ticks: { display: false },
              grid: { color: '#f1f5f9', circular: true },
              pointLabels: { font: { size: 12, family:'Inter' }, color: '#64748b' }
            }
          },
          plugins: { legend: { display: false } }
        }
      });
    }

    // ç»‘å®šæäº¤äº‹ä»¶
    $('quiz-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const data = new FormData(e.target);
      const answers = {};
      let firstUnanswered = null;

      for(let q of currentQuestions) {
        const val = data.get(`q${q.id}`);
        if(!val) {
          if(!firstUnanswered) firstUnanswered = q.id;
        } else {
          answers[q.id] = parseInt(val);
        }
      }

      if(firstUnanswered) {
        toast("è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®");
        const card = document.querySelector(`.card[data-qid="${firstUnanswered}"]`);
        card.scrollIntoView({block:'center',behavior:'smooth'});
        // ç®€å•çš„éœ‡åŠ¨åé¦ˆ
        if(navigator.vibrate) navigator.vibrate(50);
        return;
      }
      submitAnswers(answers);
    });
  </script>
</body>
</html>