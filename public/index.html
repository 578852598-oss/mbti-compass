<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MBTI 心理状态罗盘</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif+SC:wght@600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

  <style>
    :root{
      --bg:#ffffff;
      --surface:#ffffff;
      --surface-2:#f8fafc;
      --line:#e5e7eb;
      --text:#0f172a;
      --muted:#475569;
      --muted-2:#64748b;

      --accent:#2563eb;
      --accent-2:#1d4ed8;
      --success:#16a34a;
      --warning:#d97706;
      --danger:#dc2626;

      --radius:18px;
      --shadow:0 12px 30px rgba(15, 23, 42, 0.08);
      --shadow-soft:0 8px 20px rgba(15, 23, 42, 0.06);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Noto Serif SC", Arial, sans-serif;
      color:var(--text);
      background: linear-gradient(180deg, #ffffff 0%, #f6f8ff 100%);
    }

    .container{
      max-width: 860px;
      margin: 0 auto;
      padding: 28px 18px 80px;
    }

    .topbar{
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(255,255,255,0.78);
      border-bottom: 1px solid rgba(229,231,235,0.9);
    }
    .topbar-inner{
      max-width: 860px;
      margin: 0 auto;
      padding: 14px 18px;
      display:flex;
      align-items:center;
      gap:12px;
      justify-content:space-between;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width: 220px;
    }
    .logo{
      width:36px; height:36px;
      border-radius: 12px;
      background: radial-gradient(circle at 30% 30%, rgba(37,99,235,0.25), rgba(37,99,235,0.05));
      border: 1px solid rgba(37,99,235,0.18);
      display:flex;
      align-items:center;
      justify-content:center;
      color: var(--accent);
      font-weight:700;
    }
    .brand-title{ line-height:1.15; }
    .brand-title b{
      display:block;
      font-size: 14px;
      letter-spacing: 0.2px;
    }
    .brand-title span{
      font-size: 12px;
      color: var(--muted-2);
    }

    .controls{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .field{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 14px;
      background: rgba(255,255,255,0.9);
      box-shadow: var(--shadow-soft);
    }
    .field label{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }
    select{
      border:none;
      outline:none;
      background: transparent;
      font-size: 14px;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      padding-right: 4px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(37,99,235,0.2);
      color: var(--accent);
      background: rgba(37,99,235,0.06);
      font-size: 12px;
      font-weight: 600;
      white-space: nowrap;
    }

    .progress{
      width: 180px;
      height: 10px;
      border-radius: 999px;
      background: #eef2ff;
      border: 1px solid rgba(37,99,235,0.12);
      overflow:hidden;
    }
    .progress > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent), #60a5fa);
      transition: width .25s ease;
    }

    header{
      padding: 22px 0 10px;
      text-align:left;
    }
    h1{
      margin: 0 0 8px 0;
      font-family: "Noto Serif SC", serif;
      letter-spacing: 0.2px;
      font-size: 28px;
    }
    .subtitle{
      margin:0;
      color: var(--muted);
      max-width: 680px;
      line-height: 1.6;
      font-size: 14px;
    }
    .hint{
      margin-top: 12px;
      color: var(--muted-2);
      font-size: 12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .hint span{
      padding: 6px 10px;
      border:1px solid var(--line);
      border-radius: 999px;
      background: rgba(255,255,255,0.7);
    }

    .card{
      background: var(--surface);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 22px;
      margin-top: 14px;
      box-shadow: var(--shadow);
    }
    .card--error{
      border-color: rgba(220,38,38,0.35);
      box-shadow: 0 14px 30px rgba(220, 38, 38, 0.08);
    }
    .qmeta{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
      color: var(--muted-2);
      font-size: 12px;
    }
    .qmeta b{
      color: var(--text);
      font-weight: 700;
      letter-spacing:0.2px;
    }
    .qstatus{
      display:inline-flex;
      align-items:center;
      gap:8px;
      font-weight: 600;
      color: var(--muted-2);
    }
    .dot{
      width:8px; height:8px;
      border-radius:999px;
      background: #cbd5e1;
    }
    .qstatus.done{ color: var(--success); }
    .qstatus.done .dot{ background: var(--success); }

    .qtext{
      font-size: 16px;
      line-height: 1.65;
      color: var(--text);
      font-weight: 600;
      margin: 6px 0 16px;
    }

    .scale{
      display:grid;
      grid-template-columns: repeat(6, minmax(0, 1fr));
      gap:10px;
      align-items:center;
      padding: 14px;
      background: var(--surface-2);
      border: 1px solid var(--line);
      border-radius: 16px;
    }
    .scale-ends{
      width:100%;
      display:flex;
      justify-content:space-between;
      color: var(--muted-2);
      font-size: 12px;
      margin-top: 6px;
      padding: 0 6px;
    }

    .opt{
      position:relative;
      min-width: 0;
      display:flex;
      justify-content:center;
    }
    .opt input{ display:none; }
    .opt label{
      width: 100%;
      height: 42px;
      border-radius: 14px;
      border: 1px solid rgba(15,23,42,0.12);
      background: rgba(255,255,255,0.95);
      color: var(--muted);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      font-weight:700;
      transition: transform .12s ease, border-color .12s ease, box-shadow .12s ease, color .12s ease, background .12s ease;
      user-select:none;
    }
    .opt input:checked + label{
      background: rgba(37,99,235,0.08);
      border-color: rgba(37,99,235,0.35);
      color: var(--accent-2);
      box-shadow: 0 10px 22px rgba(37,99,235,0.12);
      transform: translateY(-1px);
    }

    .btn{
      width:100%;
      margin-top: 16px;
      padding: 14px 16px;
      border-radius: 16px;
      border: 1px solid rgba(37,99,235,0.25);
      background: linear-gradient(90deg, rgba(37,99,235,1), rgba(96,165,250,1));
      color:#fff;
      font-weight: 700;
      font-size: 15px;
      cursor:pointer;
      box-shadow: 0 14px 32px rgba(37,99,235,0.18);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 18px 40px rgba(37,99,235,0.2); }
    .btn:active{ transform: translateY(0px); }

    .btn-ghost{
      width:auto;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,0.9);
      border: 1px solid var(--line);
      box-shadow: var(--shadow-soft);
      font-weight: 700;
      cursor:pointer;
      color: var(--text);
    }

    #result{
      display:none;
      margin-top: 16px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }
    @media (min-width: 980px){
      .grid{ grid-template-columns: repeat(3, 1fr); }
    }

    .stat{
      padding: 18px;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.92);
      box-shadow: var(--shadow);
    }
    .stat .k{
      font-size: 12px;
      color: var(--muted-2);
      margin-bottom: 10px;
      letter-spacing: 0.2px;
    }
    .stat .v{
      font-family: "Noto Serif SC", serif;
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .stat .d{
      font-size: 12px;
      color: var(--muted);
      line-height:1.5;
    }

    .chart {
      padding: 20px;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: rgba(255, 255, 255, 0.95);
      box-shadow: var(--shadow);
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .chart-container {
      position: relative;
      width: 100%;
      max-width: 420px;
      height: 320px;
      margin: 0 auto;
    }
    @media (max-width: 480px) {
      .chart-container { height: 280px; }
    }

    .chart-head{
      width: 100%;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      margin-bottom: 10px;
    }
    .chart-title b{
      display:block;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .chart-title span{
      display:block;
      font-size: 12px;
      color: var(--muted-2);
      line-height: 1.4;
    }

    .section{
      margin-top: 14px;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.92);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .section h3{
      margin: 0 0 10px 0;
      font-size: 14px;
      letter-spacing: 0.2px;
    }
    .section p{
      margin: 0;
      color: var(--muted);
      line-height: 1.75;
      font-size: 14px;
    }

    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 20px;
      z-index: 999;
      background: rgba(15,23,42,0.92);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.12);
      padding: 10px 12px;
      border-radius: 14px;
      font-size: 13px;
      box-shadow: 0 18px 40px rgba(15,23,42,0.35);
      display:none;
      max-width: calc(100% - 24px);
    }

    .loading{
      position: fixed;
      inset: 0;
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 1000;
    }
    .loading-inner{
      width: min(420px, calc(100% - 36px));
      padding: 18px;
      border-radius: 20px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,0.92);
      box-shadow: var(--shadow);
      display:flex;
      align-items:center;
      gap: 12px;
    }
    .spinner{
      width: 28px;
      height: 28px;
      border-radius: 999px;
      border: 3px solid rgba(37,99,235,0.18);
      border-top-color: rgba(37,99,235,0.9);
      animation: spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg);} }

    @media (max-width: 720px){
      .brand{ min-width: unset; }
      .progress{ width: 140px; }
      .grid{ grid-template-columns: 1fr; }
      h1{ font-size: 24px; }
      .opt label{ width: 44px; }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo">MB</div>
        <div class="brand-title">
          <b>心理状态罗盘</b>
          <span>轻量自测 · 非医疗诊断</span>
        </div>
      </div>

      <div class="controls">
        <div class="field" title="选择你的 MBTI 类型">
          <label for="mbti-select">类型</label>
          <select id="mbti-select" aria-label="MBTI 下拉选择">
            <option>INTJ</option><option>INTP</option><option>INFJ</option><option>INFP</option>
            <option>ENFJ</option><option>ENFP</option><option>ENTJ</option><option>ENTP</option>
            <option>ISFJ</option><option>ISTP</option>
          </select>
        </div>

        <div class="pill">当前：<span id="type-text">INTP</span></div>

        <div class="progress" aria-label="答题进度">
          <div id="progress-bar"></div>
        </div>

        <button class="btn-ghost" id="reset-btn" type="button" style="display:none;">重新测评</button>
      </div>
    </div>
  </div>

  <div class="loading" id="loading">
    <div class="loading-inner" role="status" aria-live="polite">
      <div class="spinner"></div>
      <div>
        <div style="font-weight:700;">正在生成报告…</div>
        <div style="color: var(--muted-2); font-size: 12px; margin-top: 2px;">请稍等片刻</div>
      </div>
    </div>
  </div>

  <div class="container">
    <header>
      <h1>MBTI 心理状态罗盘</h1>
      <p class="subtitle">
        前端仅展示：题库/计分/叙事/雷达数据全部来自后端，以减少算法被抄袭风险。
      </p>
      <div class="hint">
        <span>量表：<b id="scale-text">1 → 6</b></span>
        <span>共 <b id="q-total">30</b> 题</span>
        <span>建议：直觉作答，避免过度推演</span>
      </div>
    </header>

    <form id="form">
      <div id="questions"></div>
      <button class="btn" type="submit">生成报告</button>
    </form>

    <section id="result">
      <div class="grid">
        <div class="stat">
          <div class="k">认知成熟度</div>
          <div class="v" id="m-v">—</div>
          <div class="d" id="m-d">—</div>
        </div>
        <div class="stat">
          <div class="k">内耗倾向</div>
          <div class="v" id="l-v">—</div>
          <div class="d" id="l-d">—</div>
        </div>
        <div class="stat">
          <div class="k">压力反应</div>
          <div class="v" id="g-v">—</div>
          <div class="d" id="g-d">—</div>
        </div>
        <div class="stat">
          <div class="k">压力负荷</div>
          <div class="v" id="load-v">—</div>
          <div class="d" id="load-d">—</div>
        </div>
        <div class="stat">
          <div class="k">自洽度</div>
          <div class="v" id="coh-v">—</div>
          <div class="d" id="coh-d">—</div>
        </div>
        <div class="stat">
          <div class="k">状态指数</div>
          <div class="v" id="o-v">—</div>
          <div class="d" id="o-d">—</div>
        </div>
      </div>

      <div class="chart">
        <div class="chart-head">
          <div class="chart-title">
            <b>状态罗盘</b> <span id="status-tag">—</span>
          </div>
          <div class="pill" id="tag-pill">—</div>
        </div>

        <div class="chart-container">
          <canvas id="chart"></canvas>
        </div>
      </div>

      <div class="section">
        <h3>核心洞察</h3>
        <p id="insight">—</p>
      </div>

      <div class="section">
        <h3>下一步建议</h3>
        <p id="advice">—</p>
      </div>
    </section>
  </div>

  <div class="toast" id="toast" role="alert"></div>

<script>
/**
 * ===================== API 配置 =====================
 * Vercel 同域部署：API_BASE 为空即可
 * 本地联调：例如 "http://localhost:8000"
 */
const API_BASE = "";
const API_BANK  = (type) => `${API_BASE}/api/bank?type=${encodeURIComponent(type)}`;
const API_REPORT = `${API_BASE}/api/report`;

let currentType = "INTP";
let currentQuestions = [];
let scaleMin = 1;
let scaleMax = 6;
let radarChart = null;

function $(id){ return document.getElementById(id); }

function toast(msg){
  const t = $("toast");
  t.textContent = msg;
  t.style.display = "block";
  clearTimeout(toast._timer);
  toast._timer = setTimeout(()=> t.style.display = "none", 2600);
}

function setLoading(on){
  $("loading").style.display = on ? "flex" : "none";
}

function shuffle(arr){
  for (let i = arr.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function setProgress(answered, total){
  const pct = total === 0 ? 0 : Math.round((answered / total) * 100);
  $("progress-bar").style.width = pct + "%";
}

function onAnswerChange(e){
  const name = e.target && e.target.name;
  if (!name || !name.startsWith("q")) return;
  const qid = name.replace("q","");
  const st = $("st-" + qid);
  if (st){
    st.className = "qstatus done";
    st.innerHTML = `<span class="dot"></span><span>已作答</span>`;
  }
  const card = document.querySelector(`.card[data-qid="${qid}"]`);
  if (card) card.classList.remove("card--error");

  const formData = new FormData($("form"));
  let answered = 0;
  currentQuestions.forEach(q=>{ if (formData.get("q"+q.id)) answered++; });
  setProgress(answered, currentQuestions.length);
}

function findFirstUnanswered(formData){
  for (const q of currentQuestions){
    if (!formData.get("q"+q.id)) return q;
  }
  return null;
}

function scrollToQuestion(qid){
  const card = document.querySelector(`.card[data-qid="${qid}"]`);
  if (!card) return;
  card.classList.add("card--error");
  card.scrollIntoView({behavior:"smooth", block:"center"});
}

async function fetchJson(url, opt){
  const resp = await fetch(url, opt);
  const text = await resp.text().catch(()=> "");
  if (!resp.ok){
    throw new Error(`HTTP ${resp.status}：${text || "请求失败"}`);
  }
  try{ return JSON.parse(text); } catch(e){
    throw new Error("返回不是合法 JSON：" + text.slice(0, 200));
  }
}

async function loadBank(type){
  const bank = await fetchJson(API_BANK(type), { method: "GET" });
  if (!bank || !Array.isArray(bank.questions)) throw new Error("题库格式错误");
  currentQuestions = shuffle([...bank.questions]); // 前端只负责展示顺序
  scaleMin = Number(bank.scale_min ?? 1);
  scaleMax = Number(bank.scale_max ?? 6);

  $("type-text").textContent = type;
  $("q-total").textContent = currentQuestions.length;
  $("scale-text").textContent = `${scaleMin} → ${scaleMax}`;

  renderQuestions();
  setProgress(0, currentQuestions.length);
}

function renderQuestions(){
  const wrap = $("questions");
  wrap.innerHTML = "";

  const points = [];
  for (let v = scaleMin; v <= scaleMax; v++) points.push(v);

  currentQuestions.forEach((q, idx) => {
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.qid = q.id;

    const qmeta = document.createElement("div");
    qmeta.className = "qmeta";
    qmeta.innerHTML = `<b>问题 ${idx + 1} / ${currentQuestions.length}</b>
      <span class="qstatus" id="st-${q.id}"><span class="dot"></span><span>未作答</span></span>`;
    card.appendChild(qmeta);

    const qtext = document.createElement("div");
    qtext.className = "qtext";
    qtext.textContent = q.text;
    card.appendChild(qtext);

    const scale = document.createElement("div");
    scale.className = "scale";

    points.forEach(v=>{
      const opt = document.createElement("div");
      opt.className = "opt";
      opt.innerHTML = `
        <input type="radio" id="q${q.id}_${v}" name="q${q.id}" value="${v}" />
        <label for="q${q.id}_${v}">${v}</label>
      `;
      scale.appendChild(opt);
    });

    const ends = document.createElement("div");
    ends.className = "scale-ends";
    ends.innerHTML = `<span>完全不符</span><span>完全符合</span>`;

    card.appendChild(scale);
    card.appendChild(ends);
    wrap.appendChild(card);
  });

  $("form").addEventListener("change", onAnswerChange);
}

function destroyChart(){
  if (radarChart){ radarChart.destroy(); radarChart = null; }
}

function renderChart(radar){
  destroyChart();
  if (!radar || !Array.isArray(radar.labels) || !Array.isArray(radar.values)) return;

  const ctx = $("chart").getContext("2d");
  const gradient = ctx.createLinearGradient(0, 0, 0, 400);
  gradient.addColorStop(0, 'rgba(37, 99, 235, 0.5)');
  gradient.addColorStop(1, 'rgba(37, 99, 235, 0.1)');

  radarChart = new Chart(ctx, {
    type: "radar",
    data: {
      labels: radar.labels,
      datasets: [{
        label: "当前状态",
        data: radar.values,
        backgroundColor: gradient,
        borderColor: "#2563eb",
        borderWidth: 2,
        pointBackgroundColor: "#ffffff",
        pointBorderColor: "#2563eb",
        pointBorderWidth: 2,
        pointRadius: 4,
        pointHoverRadius: 6,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: "rgba(15, 23, 42, 0.9)",
          padding: 10,
          cornerRadius: 8,
          displayColors: false,
          callbacks: { label: (c) => ` ${c.label}: ${c.raw} / 100` }
        }
      },
      scales: {
        r: {
          angleLines: { color: "rgba(0, 0, 0, 0.05)" },
          grid: { color: "rgba(0, 0, 0, 0.05)", circular: true },
          pointLabels: { font: { size: 12, weight: "600", family: '"Inter", sans-serif' }, color: "#475569" },
          ticks: { display: false, stepSize: 20 },
          min: 0, max: 100,
        }
      }
    }
  });
}

/**
 * 完全展示层：所有“分数解释/标签/洞察/建议/雷达值”由后端返回
 * 前端只把值塞进 DOM
 */
function renderReport(report){
  const s = report.scores || {};
  $("m-v").textContent = s.m ?? "—";
  $("l-v").textContent = s.l ?? "—";
  $("g-v").textContent = s.g ?? "—";
  $("load-v").textContent = s.load ?? "—";
  $("coh-v").textContent = s.coh ?? "—";
  $("o-v").textContent = s.o ?? "—";

  // 可选：后端返回每项解释文案（推荐你这么做，彻底前端“无脑”）
  // e.g. report.descriptions = { m:"...", l:"...", ... }
  const d = report.descriptions || {};
  $("m-d").textContent = d.m || "—";
  $("l-d").textContent = d.l || "—";
  $("g-d").textContent = d.g || "—";
  $("load-d").textContent = d.load || "—";
  $("coh-d").textContent = d.coh || "—";
  $("o-d").textContent = d.o || "—";

  $("insight").textContent = report.insight || "—";
  $("advice").textContent  = report.advice  || "—";

  const tag = report.status_tag || report.narrative_key || "—";
  $("status-tag").textContent = tag;
  $("tag-pill").textContent = tag;

  renderChart(report.radar);

  $("form").style.display = "none";
  $("result").style.display = "block";
  $("reset-btn").style.display = "inline-flex";
  window.scrollTo({top: 0, behavior: "smooth"});
}

function resetAll(){
  destroyChart();
  $("result").style.display = "none";
  $("form").reset();
  $("form").style.display = "block";
  $("reset-btn").style.display = "none";
  loadBank(currentType).catch(e=>toast(e.message || "加载失败"));
  window.scrollTo({top: 0, behavior: "smooth"});
}

async function submitReport(){
  const formData = new FormData($("form"));
  const missing = findFirstUnanswered(formData);
  if (missing){
    toast("还有未完成的题目，已定位。");
    scrollToQuestion(missing.id);
    return;
  }

  const answers = {};
  currentQuestions.forEach(q => {
    answers[String(q.id)] = parseInt(formData.get("q"+q.id), 10);
  });

  // 仅提交：前端不计算任何东西
  const payload = {
    type: currentType,
    answers: answers,
    meta: {
      // 你可以带上时间/ua等，后端按需存储
      ts: Date.now()
    }
  };

  setLoading(true);
  try{
    const report = await fetchJson(API_REPORT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    renderReport(report);
  }finally{
    setLoading(false);
  }
}

document.addEventListener("DOMContentLoaded", async () => {
  const sel = $("mbti-select");
  sel.value = "INTP";
  currentType = sel.value;
  $("type-text").textContent = currentType;

  setLoading(true);
  try{
    await loadBank(currentType);
  }catch(e){
    toast(e.message || "题库加载失败");
  }finally{
    setLoading(false);
  }

  sel.addEventListener("change", async () => {
    currentType = sel.value;
    $("type-text").textContent = currentType;
    resetAll();
    toast("已切换类型：" + currentType);
  });

  $("reset-btn").addEventListener("click", resetAll);

  $("form").addEventListener("submit", async (e) => {
    e.preventDefault();
    try{
      await submitReport();
    }catch(err){
      console.error(err);
      toast(err.message || "生成报告失败");
    }
  });
});
</script>
</body>
</html>
